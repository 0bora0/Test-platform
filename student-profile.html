<!DOCTYPE html>
<html lang="bg">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Начална странциа</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEJ2QJ7lXOTOk3vYft3sZj/dW9v/RkG8D9r6uE6xwQGJ7A1RV2mRtv1FPV+8J" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="shortcut icon" href="https://img.icons8.com/?size=100&id=11225&format=png&color=000000"
        type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="student-profile.css">
</head>

<body>

    <header class="fixed-top w-100" style="background: linear-gradient(135deg, #034687 0%, #00c379 100%);">
        <div class="container d-flex justify-content-between align-items-center py-3">
            <h1 class="h3 text-white">Тестова платформа</h1>
            <nav class="d-flex align-items-center">
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-white"
                        id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img id="userImage" src="https://via.placeholder.com/40" alt="Потребител"
                            class="rounded-circle me-2" style="width: 40px; height: 40px;">
                        <span id="userName" class="me-2">Зареждане...</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="student-profile.html">Начало</a></li>
                        <li><a class="dropdown-item" href="index1-students.html">Тестове</a></li>
                        <li><a class="dropdown-item" href="user-students.html">Регистрирани потребители</a></li>
                        <li><a class="dropdown-item" href="edit-students.html">Редактиране на профил</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-danger" href="login.html" id="logout">Изход</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main class="container mt-5 pt-5">
        <section class="row g-4 mb-4">
            <div class="col-md-3 col-sm-6">
                <div class="card-dashboard card-users p-3 text-white rounded shadow-lg"
                    style="background-color: #007bff;">
                    <h3 class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">Общо потребители
                    </h3>
                    <p id="userCount" class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">
                        Loading...</p>
                    <i class="fas fa-users fa-3x text-white animate__animated animate__bounceIn"></i>
                </div>
            </div>
            <h2 class="text-center">Предстоящи тестове</h2>
<div id="test-container" class="mt-4"></div>
            <div class="col-md-3 col-sm-6">
                <div class="card-dashboard card-students p-3 text-white rounded shadow-lg"
                    style="background-color: #28a745;">
                    <h3 class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">Студенти</h3>
                    <p id="studentCount" class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">
                        Loading...</p>
                    <i class="fas fa-user-graduate fa-3x text-white animate__animated animate__bounceIn"></i>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="card-dashboard card-average p-3 text-white rounded shadow-lg"
                    style="background-color: #ffc107;">
                    <h3 class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">Преподаватели</h3>
                    <p id="averageScore" class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">
                        Loading...</p>
                    <i class="fas fa-chalkboard-teacher fa-3x text-white animate__animated animate__bounceIn"></i>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="card-dashboard card-tests p-3 text-white rounded shadow-lg"
                    style="background-color: #17a2b8;">
                    <h3 class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">Общо въпроси</h3>
                    <p id="testCount" class="fs-4 text-white text-center fw-bold animate__animated animate__fadeIn">
                        Loading...</p>
                    <i class="fas fa-question-circle fa-3x text-white animate__animated animate__bounceIn"></i>
                </div>
            </div>
        </section>

        <section id="welcome" class="text-center mb-4">
            <h2 class="animate__animated animate__fadeIn animate__delay-1s">Добре дошли в профила си!</h2>
        </section>

        <section id="profile-container" class="container mt-2 pt-5 animate__animated animate__fadeIn mb-5">
            <div class="row g-5">
                <div class="col-md-4 col-12 d-flex justify-content-center align-items-center">
                    <div class="image-wrapper shadow-lg rounded-lg overflow-hidden">
                        <img src="https://img.freepik.com/premium-vector/male-student-character-sitting-desk-with-laptop-writing-notebook-comfortable-study-space-vector-illustration_1016-15085.jpg?semt=ais_hybrid"
                            alt="Profile Image" class="img-fluid profile-image transition-all">
                    </div>
                </div>

                <div class="col-md-8 col-12 d-flex flex-column justify-content-center">
                    <div class="operations-container shadow-lg rounded-lg p-4 bg-white">
                        <h2 class="text-center text-primary mb-4 animate__animated animate__fadeInUp">Вашите Операции
                        </h2>

                        <div class="list-group">
                            <a href="grades-students.html"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center shadow-sm rounded-pill hover-item transition-transform">
                                <span class="fs-5 text-center">Мои оценки</span>
                                <i class="fas fa-plus-circle fs-3"></i>
                            </a>
                            <p class="operation-description">Прегледайте своите оценки от направените тестове</p>
                            <a href="edit-students.html"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center shadow-sm rounded-pill hover-item transition-transform">
                                <span class="fs-5 text-center">Редактиране на профил</span>
                                <i class="fas fa-user-edit fs-3"></i>
                            </a>
                            <p class="operation-description">От тук може да редактирате вашите данни като потребителско име, име, фамилия, както и вашата парола.</p>

                            <a href="user-students.html"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center shadow-sm rounded-pill hover-item transition-transform">
                                <span class="fs-5 text-center">Регистрирани потребители</span>
                                <i class="fas fa-users fs-3"></i>
                            </a>
                            <p class="operation-description">Прегледайте потребителите, които са регистрирани в системата.</p>

                            <a href="index1-students.html"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center shadow-sm rounded-pill hover-item transition-transform">
                                <span class="fs-5 text-center">Стартиране на тест</span>
                                <i class="fas fa-play-circle fs-3"></i>
                            </a>
                            <p class="operation-description">Може да стартирате тест, да изберете брой въпроси, които ще бъдат изтеглени от банката с въпроси на лотариален принцип.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-light py-3 mt-auto" style="background: linear-gradient(135deg, #034687 0%, #00c379 100%);">
        <div class="container text-center">
            <p class="text-white mb-2">&copy; 2025 Тестова платформа. Всички права запазени.</p>
            <hr class="my-3"
                style="border: 0; height: 3px; background: linear-gradient(135deg, #010e1c 0%, #013722 100%);">
            <div>
                <a href="https://www.instagram.com" target="_blank" class="text-white me-3">
                    <i class="bi bi-instagram fs-2"></i>
                </a>
                <a href="https://www.facebook.com" target="_blank" class="text-white me-3">
                    <i class="bi bi-facebook fs-2"></i>
                </a>
                <a href="https://www.linkedin.com" target="_blank" class="text-white">
                    <i class="bi bi-linkedin fs-2"></i>
                </a>
            </div>
        </div>
    </footer>
    <script type="module">
        import { enforcePageAccess } from "./role-guard.js";
        enforcePageAccess();
    </script>
    <script type="module" src="student-profile.js"></script>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyCR-nsO0Eibf9Fmba6zp0IeyNTiZ1YTNHQ",
    authDomain: "testcenter-2025.firebaseapp.com",
    projectId: "testcenter-2025",
    storageBucket: "testcenter-2025.firebasestorage.app",
    messagingSenderId: "446759343746",
    appId: "1:446759343746:web:9025b482329802cc34069b",
    measurementId: "G-0K3X6WSL09"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();
const testContainer = document.getElementById("test-container");

onAuthStateChanged(auth, async (user) => {
    if (!user) {
        testContainer.innerHTML = `<p class='text-center text-danger fs-5'>Моля, влезте в системата.</p>`;
        return;
    }

    const q = query(collection(db, "tests"), where("usersAllowed", "array-contains", user.email));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
        testContainer.innerHTML = `
            <div class="alert alert-warning text-center fs-5">
                Няма предстоящи тестове. Очаквайте нови задания от вашия преподавател.
            </div>
        `;
        return;
    }

    testContainer.innerHTML = `<h3 class="text-center text-primary mb-3">Вашите предстоящи тестове</h3>`;

    querySnapshot.forEach((doc) => {
        const testData = doc.data();
        const testHTML = `
            <div class="card mb-3 p-3 shadow-sm">
                <h4 class="text-dark">${testData.discipline}</h4>
                <p><strong>Преподавател:</strong> ${testData.teacher}</p>
                <p><strong>Максимален резултат:</strong> ${testData.maxScore}</p>
                <p><strong>Брой въпроси:</strong> ${testData.questionCount}</p>
                <p><strong>Продължителност:</strong> ${testData.testDuration} мин.</p>
                <button class="btn btn-primary start-test mt-2 w-100" data-id="${doc.id}">Стартирай тест</button>
            </div>
        `;
        testContainer.innerHTML += testHTML;
    });

    document.querySelectorAll(".start-test").forEach(button => {
        button.addEventListener("click", function () {
            localStorage.setItem("testId", this.dataset.id);
            window.location.href = "index1.html";
        });
    });
});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>